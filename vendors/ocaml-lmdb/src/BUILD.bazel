load("@obazl_rules_ocaml//ocaml:rules.bzl", "ocaml_module", "ocaml_library", "ocaml_signature")

cc_library(
    name = "lmdb_c",
    srcs = [
        ":lmdb.h",
        ":lmdb_stubs.c",
        ":mdb.c",
        ":midl.h",
        ":midl.c",
    ],
    deps = [
        "@opam_libs//:ocaml",
    ],
)

ocaml_signature(
    name = "lmdb__sig",
    src = ":lmdb.mli",
    deps_opam = ["rresult"],
)

ocaml_module(
    name = "lmdb",
    deps_opam = ["rresult"],
    cc_deps = { ":lmdb_c": "default" },
    sig = "lmdb__sig",
    struct = ":lmdb.ml",
)

# okapi:public_name tezos-lmdb
ocaml_library(
    name = "lib-tezos-lmdb",
    modules = [":lmdb"],
    visibility = ["//visibility:public"],
)
